var SelectorGeneratorModule=(()=>{var X=Object.defineProperty;var Z=Object.getOwnPropertyDescriptor;var ee=Object.getOwnPropertyNames;var te=Object.prototype.hasOwnProperty;var re=(a,e)=>{for(var t in e)X(a,t,{get:e[t],enumerable:!0})},oe=(a,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of ee(e))!te.call(a,o)&&o!==t&&X(a,o,{get:()=>e[o],enumerable:!(r=Z(e,o))||r.enumerable});return a};var se=a=>oe(X({},"__esModule",{value:!0}),a);var le=(a,e,t)=>{if(!e.has(a))throw TypeError("Cannot "+t)};var A=(a,e,t)=>{if(e.has(a))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(a):e.set(a,t)};var C=(a,e,t)=>(le(a,e,"access private method"),t);var ie={};re(ie,{SelectorGenerator:()=>Y,SelectorGeneratorClass:()=>L});var p=class{static isValid(e){return e instanceof HTMLElement||e instanceof SVGElement}static assertValid(e){if(!this.isValid(e))throw new Error("Not an SVG/HTMLElement")}};var B=class{querySelectorAll(e){return document.querySelectorAll(e)}querySelector(e){return document.querySelector(e)}};var w,J,N=class{constructor(){A(this,w)}build(e){let t=e.filter(c=>c.type==="tag"&&c.level<=0),r=e.filter(c=>c.type==="id"&&c.level<=0),o=e.filter(c=>c.type==="class"&&c.level<=0),s=e.filter(c=>c.type==="attr"&&c.level<=0),n=e.filter(c=>c.type==="pseudo"&&c.level<=0),l=e.filter(c=>c.level>0),i=t.map(c=>c.selector).join("")+r.map(c=>c.selector).join("")+o.map(c=>c.selector).join("")+s.map(c=>c.selector).join("")+n.map(c=>c.selector).join("");if(i===""&&(i="*"),l.length>0){let c=new Map;for(let h of l)c.has(h.level)||c.set(h.level,[]),c.get(h.level).push(h);let u=Array.from(c.keys()).sort((h,g)=>h-g),T=0;for(let h of u){let g=C(this,w,J).call(this,c.get(h));h===T+1?i=g+" > "+i:i=g+" "+i,T=h}}return i}};w=new WeakSet,J=function(e){let t=e.filter(l=>l.type==="tag"),r=e.filter(l=>l.type==="id"),o=e.filter(l=>l.type==="class"),s=e.filter(l=>l.type==="attr"),n=e.filter(l=>l.type==="pseudo");return t.map(l=>l.selector).join("")+r.map(l=>l.selector).join("")+o.map(l=>l.selector).join("")+s.map(l=>l.selector).join("")+n.map(l=>l.selector).join("")};var R=class{constructor(e,t){this.domService=e,this.selectorBuilder=t}getValue(e,t){let r=this.selectorBuilder.build(t);if(r==="")return 1/0;let o=this.domService.querySelectorAll(r),s=o.length;return s===0?(console.error("Empty selector: ",r,t),1/0):Array.from(o).includes(e)?s:(console.error("Element is missing from selector results: ",r,t),1/0)}findBest(e,t){t.sort((s,n)=>s.cost-n.cost);let r=[],o=1/0;for(let s=16;s>=1;s=s/2){let n=!0;for(;n;){n=!1;let l=[...r],i=o,c=[...r],u=1/0;for(let T of t)if(!c.includes(T)&&!(r.length===0&&T.level>0)&&(c=[...r,T],u=this.getValue(e,c),i-u>=s&&(i=u,l=[...c]),u===1))break;if(o-i>0){if(r=[...l],o=i,o===1)return r;n=!0}if(i===1)break}}return r}};var V=class{constructor(e,t){this.domService=e,this.selectorBuilder=t}matches(e,t){let r=this.selectorBuilder.build(t);if(r==="")return!1;let o=this.domService.querySelectorAll(r);return Array.from(o).includes(e)}findMinimalNonMatchingSet(e,t){let r=[...t];for(let o=r.length-1;o>=0;o--){let s=r.filter((n,l)=>l!==o);this.matches(e,s)||(r=s)}return r}};var D=class{constructor(e,t){this.domService=e,this.selectorBuilder=t,this.debugOptimizer=new V(e,t)}getValue(e,t){let r=this.selectorBuilder.build(t);if(r==="")return null;let o=this.domService.querySelectorAll(r),s=o.length;if(s===0)return null;if(!Array.from(o).includes(e))return console.error("Element is missing from selector results: ",r,t),null;let n=t.reduce((l,i)=>l+i.cost,0);return{count:s,cost:n}}findBest(e,t){let r=[...t],o=this.getValue(e,r);if(!o||o.count!==1){console.warn("Top-down optimizer: All selectors combined do not produce a unique selector. Finding minimal non-matching subset for debugging.");let l=this.debugOptimizer.findMinimalNonMatchingSet(e,r);return console.log("The problematic selector is this:",l,this.selectorBuilder.build(l)),r}let s=[...r].sort((l,i)=>i.cost-l.cost),n=!0;for(;n&&r.length>1;){n=!1;for(let l of s){if(!r.includes(l)||l.level===0&&l.type==="tag")continue;let i=r.filter(u=>u!==l),c=this.getValue(e,i);if(c&&c.count===1){r=i,o=c,n=!0;break}}}return r}};var Q=["id","style"],M=["class","style"],x=["*lottie*","selector-generator"],_=["*-ng-*","ng-*","*tw-*","*[*px]*"],v=["*-ng-*","ng-*","*tw-*","xmlns*"];var U,W,f=class{static matches(e,t){if(!e||!t||t.length===0)return!1;for(let r of t)if(C(this,U,W).call(this,r).test(e))return!0;return!1}static filter(e,t){return!e||e.length===0||!t||t.length===0?e:e.filter(r=>!this.matches(r,t))}};U=new WeakSet,W=function(e){let r="^"+e.replace(/[.+?^${}()|[\]\\]/g,"\\$&").replace(/\*/g,".*")+"$";return new RegExp(r)},A(f,U);var j=class{generate(e){p.assertValid(e);let t=[];e.id!==""&&!f.matches(e.id,x)&&t.push({cost:0,level:0,type:"id",selector:"#"+CSS.escape(e.id)}),t.push({cost:2,level:0,type:"tag",selector:e.localName});for(let r=0,o=e.attributes;r<o.length;r++){let s=o.item(r).name;if(!Q.includes(s)){if(s==="class"){e.classList.forEach(n=>{f.matches(n,_)||t.push({cost:1,level:0,type:"class",selector:"."+CSS.escape(n)})});continue}f.matches(s,v)||t.push({cost:3,level:0,type:"attr",selector:"["+CSS.escape(s)+"]"})}}return t}};var q=class{constructor(e,t=["class","style"]){this.targetElement=e,this.ignoredAttributes=t}collectExtraIds(e){let t=[];for(let r=0;r<e.length;r++){let o=e[r];if(o===this.targetElement)continue;let s=o.getAttribute("id");s!==null&&!f.matches(s,x)&&t.push(CSS.escape(s))}return t}collectExtraClasses(e){let t=[];for(let r=0;r<e.length;r++){let o=e[r];o!==this.targetElement&&o.classList.forEach(s=>{!this.targetElement.classList.contains(s)&&!t.includes(s)&&!f.matches(s,_)&&t.push(CSS.escape(s))})}return t}collectExtraAttributes(e){let t=[];for(let r=0;r<e.length;r++){let o=e[r];if(o===this.targetElement)continue;let s=o.attributes;for(let n=0;n<s.length;n++){let l=s.item(n);!this.ignoredAttributes.includes(l.name)&&!this.targetElement.hasAttribute(l.name)&&!t.includes(l.name)&&!f.matches(l.name,v)&&t.push(CSS.escape(l.name))}}return t}collectAll(e){return{extraIds:this.collectExtraIds(e),extraClasses:this.collectExtraClasses(e),extraAttributes:this.collectExtraAttributes(e)}}};var K=class{constructor(e,t,r){this.domService=e,this.localGenerator=t,this.selectorBuilder=r}generate(e){p.assertValid(e);let t=this.localGenerator.generate(e),r=this.selectorBuilder.build(t),o=this.domService.querySelectorAll(r),s=[],n=new q(e,M),{extraIds:l,extraClasses:i,extraAttributes:c}=n.collectAll(o);for(let u=0;u<l.length;u++)s.push({cost:10,level:0,type:"pseudo",selector:":not(#"+l[u]+")"});for(let u=0;u<i.length;u++)s.push({cost:11,level:0,type:"pseudo",selector:":not(."+i[u]+")"});for(let u=0;u<c.length;u++)s.push({cost:13,level:0,type:"pseudo",selector:":not(["+c[u]+"])"});return s}};var G,F,$=class{constructor(e){A(this,G);this.localGenerator=e}generate(e){p.assertValid(e);let t=[];return C(this,G,F).call(this,e,0,t),t}};G=new WeakSet,F=function(e,t,r){let o=e.children,s=">*".repeat(t);if(o.length===0)return e.childNodes.length>0&&t===0?(r.push({cost:t*1+10+5+100,level:0,type:"pseudo",selector:":not(:has(>*))"}),r):(e.childNodes.length===0&&(r.push({cost:t*1+5+100,level:0,type:"pseudo",selector:t>0?`:has(${s}:empty)`:":empty"}),t>0&&r.push({cost:106,level:0,type:"pseudo",selector:":has(:empty)"})),r);r.push({cost:t*1+5+100,level:0,type:"pseudo",selector:t>0?`:has(${s}>*:nth-child(${o.length}):last-child)`:`:has(:nth-child(${o.length}):last-child)`}),t>0&&r.push({cost:106,level:0,type:"pseudo",selector:`:has(* :nth-child(${o.length}):last-child)`});for(let n=0;n<o.length;n++){let l=o[n],i=this.localGenerator.generate(l);for(let c of i)r.push({cost:t*1+5+100+c.cost,level:0,type:"pseudo",selector:t>0?`:has(${s}>${c.selector})`:`:has(>${c.selector})`}),t>0&&r.push({cost:106+c.cost,level:0,type:"pseudo",selector:`:has(* ${c.selector})`});C(this,G,F).call(this,l,t+1,r)}};var H=class{constructor(e,t,r){this.domService=e,this.localGenerator=t,this.selectorBuilder=r}generate(e){p.assertValid(e);let t=this.localGenerator.generate(e),r=this.selectorBuilder.build(t)+" *",o=this.domService.querySelectorAll(r),s=[],n=[],l=[];for(let i=0;i<o.length;i++){let c=o[i];if(e.contains(c))continue;let u=c.getAttribute("id");u!==null&&!f.matches(u,x)&&s.push({cost:115,level:0,type:"pseudo",selector:":not(:has(#"+CSS.escape(u)+"))"}),c.classList.forEach(h=>{!e.querySelector("."+CSS.escape(h))&&!n.includes(h)&&!f.matches(h,_)&&n.push(CSS.escape(h))});let T=c.attributes;for(let h=0;h<T.length;h++){let g=T.item(h);!M.includes(g.name)&&!e.querySelector("["+CSS.escape(g.name)+"]")&&!l.includes(g.name)&&!f.matches(g.name,v)&&l.push(CSS.escape(g.name))}}for(let i=0;i<n.length;i++)s.push({cost:116,level:0,type:"pseudo",selector:":not(:has(."+n[i]+"))"});for(let i=0;i<l.length;i++)s.push({cost:118,level:0,type:"pseudo",selector:":not(:has(["+l[i]+"]))"});return s}};var z=class{constructor(e){this.localGenerator=e}generate(e){p.assertValid(e);let t=[],r=e.previousElementSibling,o=r!==null?Array.from(e.parentElement.children).indexOf(e):0,s=e.nextElementSibling,n=s!==null?Array.from(e.parentElement.children).length-Array.from(e.parentElement.children).indexOf(e):0;for(r===null?t.push({cost:(n+1)*1+100,level:0,type:"pseudo",selector:":first-child"}):t.push({cost:(o+1)*1+100,level:0,type:"pseudo",selector:":nth-child("+(o+1)+")"}),s===null?t.push({cost:(o+1)*1+100,level:0,type:"pseudo",selector:":last-child"}):o>0&&t.push({cost:(n+1)*1+100,level:0,type:"pseudo",selector:":nth-last-child("+n+")"}),r===null&&s===null&&t.push({cost:100,level:0,type:"pseudo",selector:":only-child"});r;){if(r.nodeType===Node.COMMENT_NODE){r=r.previousElementSibling;continue}if(r.nodeType===Node.TEXT_NODE){r=r.previousElementSibling;continue}let l=this.localGenerator.generate(r);for(let i of l)t.some(c=>c.selector===":is("+i.selector+" ~ *)")||t.push({cost:105+i.cost,level:0,type:"pseudo",selector:":is("+i.selector+" ~ *)"});r=r.previousElementSibling}for(;s;){if(s.nodeType===Node.COMMENT_NODE){s=s.nextElementSibling;continue}if(s.nodeType===Node.TEXT_NODE){s=s.nextElementSibling;continue}let l=this.localGenerator.generate(s);for(let i of l)t.some(c=>c.selector===":has(~ "+i.selector+")")||t.push({cost:105+i.cost,level:0,type:"pseudo",selector:":has(~ "+i.selector+")"});s=s.nextElementSibling}return t}};var k=class{constructor(e,t,r){this.localGenerator=e,this.exclusionGenerator=t,this.siblingGenerator=r}generate(e){p.assertValid(e);let t=[],r=e.parentElement,o=1;for(;r;){let s=this.localGenerator.generate(r);for(let i of s)t.push({cost:o*1+10+i.cost,level:o,type:i.type,selector:i.selector});let n=this.exclusionGenerator.generate(r);for(let i of n)t.push({cost:o*1+10+i.cost,level:o,type:i.type,selector:i.selector});let l=this.siblingGenerator.generate(r);for(let i of l)t.push({cost:o*1+10+i.cost,level:o,type:i.type,selector:i.selector});r=r.parentElement,o=o+1}return t}};var L=class{constructor(){this.domService=new B,this.selectorBuilder=new N,this.bottomUpOptimizer=new R(this.domService,this.selectorBuilder),this.topDownOptimizer=new D(this.domService,this.selectorBuilder),this.localGenerator=new j,this.exclusionGenerator=new K(this.domService,this.localGenerator,this.selectorBuilder),this.childrenGenerator=new $(this.localGenerator),this.childrenExclusionGenerator=new H(this.domService,this.localGenerator,this.selectorBuilder),this.siblingGenerator=new z(this.localGenerator),this.parentGenerator=new k(this.localGenerator,this.exclusionGenerator,this.siblingGenerator)}getSelector(e){p.assertValid(e);let t=[];t=t.concat(this.localGenerator.generate(e)),t=t.concat(this.exclusionGenerator.generate(e)),t=t.concat(this.childrenGenerator.generate(e)),t=t.concat(this.siblingGenerator.generate(e)),t=t.concat(this.parentGenerator.generate(e)),t=t.concat(this.childrenExclusionGenerator.generate(e));let r=this.topDownOptimizer.findBest(e,t);return this.selectorBuilder.build(r)}};var Y=function(){"use strict";let a=new L;return{getSelector:e=>a.getSelector(e)}}();typeof window<"u"&&(window.SelectorGenerator=Y);return se(ie);})();
//# sourceMappingURL=selector-generator.min.js.map
